<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo de Ciencia Helenística - Octavos, Cuartos y Semifinales</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            margin: 10px;
        }
        .phase-container {
            width: 100%;
            max-width: 1200px;
            margin-bottom: 40px;
        }
        .matchup-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); /* Adaptable para responsividad */
            gap: 20px;
            justify-items: center;
            align-items: center;
            width: 100%;
        }
        .pair-container {
            display: flex;
            flex-direction: row; /* Organizar horizontalmente */
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 10px;
            background-color: #f0f8ff;
            width: 100%; /* Cada pareja ocupa todo el espacio horizontal disponible */
            max-width: 300px;
        }
        .philosopher-cell {
            padding: 10px 15px;
            background-color: #e8f0fe;
            border: 2px solid #0044cc;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            width: 120px;
            height: 50px;
            margin: 0 5px;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .philosopher-cell.active {
            background-color: #d4edda;
            border-color: #28a745;
        }
        /* Estilos para las fases */
        .phase-title {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        /* Estilos para los Cuartos de Final */
        .quarterfinals .philosopher-cell {
            background-color: #fff3cd;
            border-color: #ffc107;
            cursor: not-allowed; /* Inicialmente no seleccionables */
        }
        .quarterfinals .philosopher-cell.active {
            background-color: #ffeeba;
            border-color: #fd7e14;
            cursor: pointer; /* Habilitar al tener contenido */
        }
        /* Estilos para las Semifinales */
        .semifinals .philosopher-cell {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            cursor: not-allowed; /* Inicialmente no seleccionables */
        }
        .semifinals .philosopher-cell.active {
            background-color: #bee5eb;
            border-color: #0c5460;
            cursor: pointer; /* Habilitar al tener contenido */
            animation: blinking 1s infinite; /* Añadida animación de parpadeo */
            box-shadow: 0 0 10px #0c5460; /* Añadido efecto de resplandor */
        }
        /* Definición de la animación de parpadeo */
        @keyframes blinking {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        /* Botón de reinicio */
        #resetButton {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        #resetButton:hover {
            background-color: #c82333;
        }
        /* Botón "Pasar a la Final" */
        #finalButton {
            display: none; /* Inicialmente oculto */
            width: 100px;
            height: 100px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            margin: 20px auto;
            transition: background-color 0.3s;
            display: block; /* Para centrarlo */
        }
        #finalButton:hover {
            background-color: #0056b3;
        }
        /* Sección de la Final */
        #finalSection {
            display: none; /* Inicialmente oculto */
            text-align: center;
            width: 100%;
            max-width: 1200px;
        }
        /* Estilos adicionales para la final */
        #finalSection h1 {
            margin-top: 40px;
            color: #333;
        }
        /* Estilos para la final-matchup */
        .final-matchup {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        /* Estilos para el Campeón */
        #champion {
            margin-top: 30px;
            font-size: 24px;
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Torneo de Ciencia Helenística</h1>

    <!-- Octavos de Final -->
    <div class="phase-container" id="octavos">
        <h2 class="phase-title">Octavos de Final</h2>
        <div class="matchup-container">
            <!-- Octavos 1 a 8 -->
            <div class="pair-container" data-octavos="1">
                <div class="philosopher-cell" data-group="1">Arquímedes</div>
                <div class="philosopher-cell" data-group="1">Ctesibio</div>
            </div>
            <div class="pair-container" data-octavos="2">
                <div class="philosopher-cell" data-group="2">Euclides</div>
                <div class="philosopher-cell" data-group="2">Cleopatra la Alquimista</div>
            </div>
            <div class="pair-container" data-octavos="3">
                <div class="philosopher-cell" data-group="3">Eratóstenes</div>
                <div class="philosopher-cell" data-group="3">Dioscórides</div>
            </div>
            <div class="pair-container" data-octavos="4">
                <div class="philosopher-cell" data-group="4">Hiparco</div>
                <div class="philosopher-cell" data-group="4">Estrabón</div>
            </div>
            <div class="pair-container" data-octavos="5">
                <div class="philosopher-cell" data-group="5">Ptolomeo</div>
                <div class="philosopher-cell" data-group="5">Erasístrato</div>
            </div>
            <div class="pair-container" data-octavos="6">
                <div class="philosopher-cell" data-group="6">Aristarco de Samos</div>
                <div class="philosopher-cell" data-group="6">Herófilo</div>
            </div>
            <div class="pair-container" data-octavos="7">
                <div class="philosopher-cell" data-group="7">Hipatia</div>
                <div class="philosopher-cell" data-group="7">Apolonio de Perge</div>
            </div>
            <div class="pair-container" data-octavos="8">
                <div class="philosopher-cell" data-group="8">Herón de Alejandría</div>
                <div class="philosopher-cell" data-group="8">Posidonio</div>
            </div>
        </div>
    </div>

    <!-- Cuartos de Final -->
    <div class="phase-container" id="cuartos">
        <h2 class="phase-title">Cuartos de Final</h2>
        <div class="matchup-container quarterfinals">
            <!-- Cuartos 1 a 4 -->
            <div class="pair-container" data-cuarto="1">
                <div class="philosopher-cell" data-cuarto="1a">-</div>
                <div class="philosopher-cell" data-cuarto="1b">-</div>
            </div>
            <div class="pair-container" data-cuarto="2">
                <div class="philosopher-cell" data-cuarto="2a">-</div>
                <div class="philosopher-cell" data-cuarto="2b">-</div>
            </div>
            <div class="pair-container" data-cuarto="3">
                <div class="philosopher-cell" data-cuarto="3a">-</div>
                <div class="philosopher-cell" data-cuarto="3b">-</div>
            </div>
            <div class="pair-container" data-cuarto="4">
                <div class="philosopher-cell" data-cuarto="4a">-</div>
                <div class="philosopher-cell" data-cuarto="4b">-</div>
            </div>
        </div>
    </div>

    <!-- Semifinales -->
    <div class="phase-container" id="semifinales">
        <h2 class="phase-title">Semifinales</h2>
        <div class="matchup-container semifinals">
            <!-- Semifinal 1 y 2 -->
            <div class="pair-container" data-semifinal="1">
                <div class="philosopher-cell" data-semifinal="1a">-</div>
                <div class="philosopher-cell" data-semifinal="1b">-</div>
            </div>
            <div class="pair-container" data-semifinal="2">
                <div class="philosopher-cell" data-semifinal="2a">-</div>
                <div class="philosopher-cell" data-semifinal="2b">-</div>
            </div>
        </div>
        <!-- Botón "Pasar a la Final" -->
        <button id="finalButton">PASAR A LA FINAL</button>
    </div>

    <!-- Final -->
    <div class="phase-container" id="finalSection">
        <h1>GRAN FINAL</h1>
        <div class="matchup-container final-matchup">
            <div class="philosopher-cell" id="finalWinner1" data-final="1">-</div>
            <div class="philosopher-cell" id="finalWinner2" data-final="2">-</div>
        </div>
        <div id="champion"></div>
    </div>

    <!-- Botón de reinicio -->
    <button id="resetButton">Reiniciar Torneo</button>

    <script>
        // Funcionalidad para Octavos de Final
        const octavosCells = document.querySelectorAll('#octavos .philosopher-cell');
        const cuartosCells = document.querySelectorAll('#cuartos .philosopher-cell');
        const semifinalCells = document.querySelectorAll('#semifinales .philosopher-cell');

        // Mapeo de Octavos a Cuartos
        const mappingCuartos = {
            1: { cuarto: 1, slot: 'a' },
            2: { cuarto: 1, slot: 'b' },
            3: { cuarto: 2, slot: 'a' },
            4: { cuarto: 2, slot: 'b' },
            5: { cuarto: 3, slot: 'a' },
            6: { cuarto: 3, slot: 'b' },
            7: { cuarto: 4, slot: 'a' },
            8: { cuarto: 4, slot: 'b' }
        };

        // Mapeo de Cuartos a Semifinales
        const mappingSemifinal = {
            1: { semifinal: 1, slot: 'a' },
            2: { semifinal: 1, slot: 'b' },
            3: { semifinal: 2, slot: 'a' },
            4: { semifinal: 2, slot: 'b' }
        };

        // Mapeo de Semifinales a Final
        const mappingFinal = {
            1: { final: 1, slot: 'a' },
            2: { final: 1, slot: 'b' }
        };

        // Función para actualizar Cuartos de Final
        function updateCuartos(octavosNumber, winnerName) {
            if (!winnerName || winnerName === '-') return; // Evitar actualizar con valores inválidos

            const { cuarto, slot } = mappingCuartos[octavosNumber];
            const cuartoCell = document.querySelector(`#cuartos .pair-container[data-cuarto="${cuarto}"] .philosopher-cell[data-cuarto="${cuarto}${slot}"]`);
            if (cuartoCell) {
                cuartoCell.textContent = winnerName;
                cuartoCell.classList.add('active');
                // Habilitar selección en Cuartos de Final si ambos slots están llenos
                const pairContainer = document.querySelector(`#cuartos .pair-container[data-cuarto="${cuarto}"]`);
                const cells = pairContainer.querySelectorAll('.philosopher-cell');
                const hasBoth = Array.from(cells).every(cell => cell.textContent !== '-');
                if (hasBoth) {
                    cells.forEach(cell => {
                        cell.style.cursor = 'pointer';
                        cell.setAttribute('tabindex', '0');
                        cell.setAttribute('role', 'button');
                        // Añadir accesibilidad para teclado
                        cell.addEventListener('keydown', handleKeyDown);
                        cell.addEventListener('click', handleCuartoClick);
                    });
                }
                // Verificar y actualizar Semifinales
                checkCuartosComplete();
            } else {
                console.error(`No se encontró la celda de Cuartos para cuarto ${cuarto} y slot ${slot}.`);
            }
        }

        // Función para actualizar Semifinales
        function updateSemifinal(cuartoNumber, winnerName) {
            if (!winnerName || winnerName === '-') return; // Evitar actualizar con valores inválidos

            const { semifinal, slot } = mappingSemifinal[cuartoNumber];
            const semifinalCell = document.querySelector(`#semifinales .pair-container[data-semifinal="${semifinal}"] .philosopher-cell[data-semifinal="${semifinal}${slot}"]`);
            if (semifinalCell) {
                semifinalCell.textContent = winnerName;
                semifinalCell.classList.add('active');
                // Habilitar selección en Semifinales si ambos slots están llenos
                const pairContainer = document.querySelector(`#semifinales .pair-container[data-semifinal="${semifinal}"]`);
                const cells = pairContainer.querySelectorAll('.philosopher-cell');
                const hasBoth = Array.from(cells).every(cell => cell.textContent !== '-');
                if (hasBoth) {
                    cells.forEach(cell => {
                        cell.style.cursor = 'pointer';
                        cell.setAttribute('tabindex', '0');
                        cell.setAttribute('role', 'button');
                        // Añadir accesibilidad para teclado
                        cell.addEventListener('keydown', handleKeyDown);
                        cell.addEventListener('click', handleSemifinalClick);
                    });
                }
                // Verificar y mostrar el botón de final si todas las semifinales están completas
                checkSemifinalsComplete();
            } else {
                console.error(`No se encontró la celda de Semifinal para semifinal ${semifinal} y slot ${slot}.`);
            }
        }

        // Función para manejar clics en Cuartos de Final
        function handleCuartoClick(event) {
            const cell = event.currentTarget;
            const group = cell.getAttribute('data-cuarto');
            const pairContainer = cell.parentElement;
            const cuartoNumber = pairContainer.getAttribute('data-cuarto');
            const groupCells = document.querySelectorAll(`#cuartos .philosopher-cell[data-cuarto="${group}"]`);

            // Deseleccionar otros en el mismo grupo
            groupCells.forEach(c => c.classList.remove('active'));
            // Seleccionar el actual
            cell.classList.add('active');
            // Actualizar Semifinales
            updateSemifinal(cuartoNumber, cell.textContent);
        }

        // Función para manejar clics en Semifinales
        function handleSemifinalClick(event) {
            const cell = event.currentTarget;
            const group = cell.getAttribute('data-semifinal'); // "1a", "1b", etc.
            const pairContainer = cell.parentElement; // La pareja de semifinal
            const semifinalNumber = pairContainer.getAttribute('data-semifinal'); // "1" o "2"

            // Seleccionar todas las celdas dentro de la misma pareja de semifinal
            const groupCells = pairContainer.querySelectorAll('.philosopher-cell');

            // Deseleccionar todas las celdas en la pareja
            groupCells.forEach(c => c.classList.remove('active'));
            // Seleccionar la celda actual
            cell.classList.add('active');

            // Aquí se verifica si todas las semifinales están completas para mostrar el botón
            checkSemifinalsComplete();
        }

        // Función para manejar eventos de teclado
        function handleKeyDown(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                e.currentTarget.click();
            }
        }

        // Función para verificar si todas las Cuartos están completas y actualizar Semifinales
        function checkCuartosComplete() {
            const allCuartos = document.querySelectorAll('#cuartos .pair-container');
            let complete = true;
            allCuartos.forEach(pair => {
                const cells = pair.querySelectorAll('.philosopher-cell');
                const pairComplete = Array.from(cells).every(cell => cell.textContent !== '-');
                if (!pairComplete) {
                    complete = false;
                }
            });
            if (complete) {
                // Aquí podrías agregar lógica adicional si es necesario
            }
        }

        // Función para verificar si todas las Semifinales están completas
        function checkSemifinalsComplete() {
            const allSemifinals = document.querySelectorAll('#semifinales .pair-container');
            let complete = true;
            allSemifinals.forEach(pair => {
                const cells = pair.querySelectorAll('.philosopher-cell');
                // Verificar que exactamente una celda por pareja esté activa
                const activeCells = Array.from(cells).filter(cell => cell.classList.contains('active'));
                if (activeCells.length !== 1) {
                    complete = false;
                }
            });
            const finalButton = document.getElementById('finalButton');
            if (complete) {
                finalButton.style.display = 'block';
            } else {
                finalButton.style.display = 'none';
            }
        }

        // Función para manejar la selección del ganador final
        function selectFinalWinner(event) {
            const cell = event.currentTarget;
            const finalCells = document.querySelectorAll('#finalSection .philosopher-cell');
            const championDisplay = document.getElementById('champion');

            // Deseleccionar otras celdas de la final
            finalCells.forEach(c => c.classList.remove('active'));
            // Seleccionar la celda actual
            cell.classList.add('active');

            // Mostrar al campeón
            championDisplay.textContent = `¡La Victoria es para ${cell.textContent}! 🎉`;
            championDisplay.innerHTML += `
                <br>
                <span style="font-size: 4rem; display: block;">🏆</span>
            `;
        }

        // Inicialización al cargar la página
        window.addEventListener('DOMContentLoaded', () => {
            // Limpiar todas las selecciones al iniciar
            // Octavos de Final
            octavosCells.forEach(cell => {
                cell.classList.remove('active');
                // Añadir accesibilidad para teclado
                cell.setAttribute('role', 'button');
                cell.setAttribute('tabindex', '0');
                cell.addEventListener('keydown', handleKeyDown);
                cell.addEventListener('click', () => {
                    const group = cell.getAttribute('data-group');
                    const pairContainer = cell.parentElement;
                    const octavosNumber = pairContainer.getAttribute('data-octavos');
                    const groupCells = document.querySelectorAll(`#octavos .philosopher-cell[data-group="${group}"]`);

                    // Deseleccionar otros en el mismo grupo
                    groupCells.forEach(c => c.classList.remove('active'));
                    // Seleccionar el actual
                    cell.classList.add('active');
                    // Actualizar Cuartos de Final
                    updateCuartos(octavosNumber, cell.textContent);
                });
            });

            // Cuartos de Final
            cuartosCells.forEach(cell => {
                cell.textContent = '-';
                cell.classList.remove('active');
                cell.style.cursor = 'not-allowed';
                cell.removeAttribute('tabindex');
                cell.removeAttribute('role');
                // Remover eventos antiguos si los hay
                cell.removeEventListener('click', handleCuartoClick);
                cell.removeEventListener('keydown', handleKeyDown);
            });

            // Semifinales
            semifinalCells.forEach(cell => {
                cell.textContent = '-';
                cell.classList.remove('active');
                cell.style.cursor = 'not-allowed';
                cell.removeAttribute('tabindex');
                cell.removeAttribute('role');
                // Remover eventos antiguos si los hay
                cell.removeEventListener('click', handleSemifinalClick);
                cell.removeEventListener('keydown', handleKeyDown);
            });

            // Final
            const finalWinner1 = document.getElementById('finalWinner1');
            const finalWinner2 = document.getElementById('finalWinner2');
            finalWinner1.textContent = '-';
            finalWinner2.textContent = '-';
            finalWinner1.classList.remove('active');
            finalWinner2.classList.remove('active');
            finalWinner1.style.cursor = 'not-allowed';
            finalWinner2.style.cursor = 'not-allowed';
            finalWinner1.removeAttribute('tabindex');
            finalWinner2.removeAttribute('tabindex');
            finalWinner1.removeAttribute('role');
            finalWinner2.removeAttribute('role');
            finalWinner1.removeEventListener('click', selectFinalWinner);
            finalWinner2.removeEventListener('click', selectFinalWinner);
            finalWinner1.removeEventListener('keydown', handleKeyDown);
            finalWinner2.removeEventListener('keydown', handleKeyDown);

            // Limpiar el campeón
            const championDisplay = document.getElementById('champion');
            championDisplay.textContent = '';

            // Inicialmente, el botón de final está oculto
            const finalButton = document.getElementById('finalButton');
            finalButton.style.display = 'none';
        });

        // Funcionalidad para el botón de "Pasar a la Final"
        const finalButton = document.getElementById('finalButton');
        const finalSection = document.getElementById('finalSection');
        const semifinalContainer = document.getElementById('semifinales');

        finalButton.addEventListener('click', () => {
            // Obtener los ganadores de las semifinales
            const semifinal1 = document.querySelector('#semifinales .pair-container[data-semifinal="1"] .philosopher-cell.active');
            const semifinal2 = document.querySelector('#semifinales .pair-container[data-semifinal="2"] .philosopher-cell.active');

            if (!semifinal1 || !semifinal2) {
                alert('Debe seleccionar un ganador en cada semifinal antes de pasar a la final.');
                return;
            }

            // Poblar las celdas de la final con los ganadores de las semifinales
            const finalWinner1 = document.getElementById('finalWinner1');
            const finalWinner2 = document.getElementById('finalWinner2');

            finalWinner1.textContent = semifinal1.textContent;
            finalWinner2.textContent = semifinal2.textContent;

            // Habilitar selección en la final
            finalWinner1.classList.add('active');
            finalWinner2.classList.add('active');
            finalWinner1.style.cursor = 'pointer';
            finalWinner2.style.cursor = 'pointer';
            finalWinner1.setAttribute('tabindex', '0');
            finalWinner2.setAttribute('tabindex', '0');
            finalWinner1.setAttribute('role', 'button');
            finalWinner2.setAttribute('role', 'button');

            // Añadir eventos para seleccionar el campeón
            finalWinner1.addEventListener('click', selectFinalWinner);
            finalWinner2.addEventListener('click', selectFinalWinner);
            finalWinner1.addEventListener('keydown', handleKeyDown);
            finalWinner2.addEventListener('keydown', handleKeyDown);

            // Ocultar todas las fases anteriores
            document.getElementById('octavos').style.display = 'none';
            document.getElementById('cuartos').style.display = 'none';
            semifinalContainer.style.display = 'none';
            // Mostrar la sección de la final
            finalSection.style.display = 'block';
            // Scroll hacia la final para mejor visibilidad
            finalSection.scrollIntoView({ behavior: 'smooth' });
        });

        // Funcionalidad para el botón de reinicio
        const resetButton = document.getElementById('resetButton');
        resetButton.addEventListener('click', () => {
            if (confirm('¿Estás seguro de que deseas reiniciar el torneo? Todas las selecciones se perderán.')) {
                // Limpiar todas las selecciones
                // Octavos de Final
                octavosCells.forEach(cell => {
                    cell.classList.remove('active');
                    cell.textContent = cell.textContent; // Mantener los nombres iniciales
                });
                // Cuartos de Final
                cuartosCells.forEach(cell => {
                    cell.textContent = '-';
                    cell.classList.remove('active');
                    cell.style.cursor = 'not-allowed';
                    cell.removeAttribute('tabindex');
                    cell.removeAttribute('role');
                    // Remover eventos antiguos si los hay
                    cell.removeEventListener('click', handleCuartoClick);
                    cell.removeEventListener('keydown', handleKeyDown);
                });
                // Semifinales
                semifinalCells.forEach(cell => {
                    cell.textContent = '-';
                    cell.classList.remove('active');
                    cell.style.cursor = 'not-allowed';
                    cell.removeAttribute('tabindex');
                    cell.removeAttribute('role');
                    // Remover eventos antiguos si los hay
                    cell.removeEventListener('click', handleSemifinalClick);
                    cell.removeEventListener('keydown', handleKeyDown);
                });
                // Final
                const finalWinner1 = document.getElementById('finalWinner1');
                const finalWinner2 = document.getElementById('finalWinner2');
                finalWinner1.textContent = '-';
                finalWinner2.textContent = '-';
                finalWinner1.classList.remove('active');
                finalWinner2.classList.remove('active');
                finalWinner1.style.cursor = 'not-allowed';
                finalWinner2.style.cursor = 'not-allowed';
                finalWinner1.removeAttribute('tabindex');
                finalWinner2.removeAttribute('tabindex');
                finalWinner1.removeAttribute('role');
                finalWinner2.removeAttribute('role');
                finalWinner1.removeEventListener('click', selectFinalWinner);
                finalWinner2.removeEventListener('click', selectFinalWinner);
                finalWinner1.removeEventListener('keydown', handleKeyDown);
                finalWinner2.removeEventListener('keydown', handleKeyDown);

                // Limpiar el campeón
                const championDisplay = document.getElementById('champion');
                championDisplay.textContent = '';

                // Ocultar la sección de la final si está visible
                finalSection.style.display = 'none';
                // Mostrar todas las fases anteriores
                document.getElementById('octavos').style.display = 'block';
                document.getElementById('cuartos').style.display = 'block';
                semifinalContainer.style.display = 'block';
                // Ocultar el botón de final nuevamente
                finalButton.style.display = 'none';
            }
        });
    </script>
</body>
</html>
